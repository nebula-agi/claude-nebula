#!/usr/bin/env node
var M=Object.create;var k=Object.defineProperty;var L=Object.getOwnPropertyDescriptor;var U=Object.getOwnPropertyNames;var z=Object.getPrototypeOf,B=Object.prototype.hasOwnProperty;var A=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports);var G=(s,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of U(e))!B.call(s,n)&&n!==t&&k(s,n,{get:()=>e[n],enumerable:!(o=L(e,n))||o.enumerable});return s};var v=(s,e,t)=>(t=s!=null?M(z(s)):{},G(e||!s||!s.__esModule?k(t,"default",{value:s,enumerable:!0}):t,s));var O=A(f=>{"use strict";Object.defineProperty(f,"__esModule",{value:!0});var N=(s=>(s.ENTITY="entity",s.RELATIONSHIP="relationship",s.COMMUNITY="community",s))(N||{}),_=class extends Error{constructor(s,e,t){super(s),this.statusCode=e,this.details=t,this.name="NebulaException"}},d=class extends _{constructor(s,e){super(s),this.cause=e,this.name="NebulaClientException"}},I=class extends _{constructor(s="Invalid API key"){super(s,401),this.name="NebulaAuthenticationException"}},T=class extends _{constructor(s="Rate limit exceeded"){super(s,429),this.name="NebulaRateLimitException"}},S=class extends _{constructor(s="Validation error",e){super(s,400),this.details=e,this.name="NebulaValidationException"}},H=class extends _{constructor(s="Collection not found"){super(s,404),this.name="NebulaCollectionNotFoundException"}},w=class extends _{constructor(s,e="Resource"){super(`${e} not found: ${s}`,404),this.name="NebulaNotFoundException"}},P=class j{constructor(e={}){if(this.apiKey=e.apiKey,!this.apiKey)throw new d("API key is required. Pass it to the constructor or set NEBULA_API_KEY environment variable.");this.baseUrl=(e.baseUrl||"https://api.trynebula.ai").replace(/\/$/,""),this.timeout=e.timeout||3e4}setApiKey(e){this.apiKey=e}setBaseUrl(e){this.baseUrl=(e||this.baseUrl).replace(/\/$/,"")}setCorsProxy(e){}isApiKeySet(){return!!(this.apiKey&&this.apiKey.trim()!=="")}_isNebulaApiKey(e){let t=e||this.apiKey;if(!t)return!1;let o=t.split(".");if(o.length!==2)return!1;let[n,i]=o;return(n.startsWith("key_")||n.startsWith("neb_"))&&!!i&&i.length>0}_buildAuthHeaders(e=!0){let t={};return this._isNebulaApiKey()?t["X-API-Key"]=this.apiKey:t.Authorization=`Bearer ${this.apiKey}`,e&&(t["Content-Type"]="application/json"),t}_isRecord(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}_unwrapResults(e){return this._isRecord(e)&&"results"in e?e.results:e}_unwrapResultsArray(e){let t=this._unwrapResults(e);return Array.isArray(t)?t:t==null?[]:[t]}_looksLikeMultimodalContent(e){return Array.isArray(e)?e.some(t=>this._isRecord(t)?typeof t.type=="string"||"data"in t||"s3_key"in t||"url"in t:!1):!1}_normalizeContentParts(e){return e.map(t=>typeof t=="string"?{type:"text",text:t}:this._isRecord(t)?typeof t.type=="string"?t:"s3_key"in t&&typeof t.s3_key=="string"?{type:"s3_ref",s3_key:t.s3_key,bucket:typeof t.bucket=="string"?t.bucket:void 0,media_type:typeof t.media_type=="string"?t.media_type:"application/octet-stream",filename:typeof t.filename=="string"?t.filename:void 0,size_bytes:typeof t.size_bytes=="number"?t.size_bytes:void 0}:"data"in t&&typeof t.data=="string"?{type:"file",data:t.data,media_type:typeof t.media_type=="string"?t.media_type:"application/octet-stream",filename:typeof t.filename=="string"?t.filename:void 0,duration_seconds:typeof t.duration_seconds=="number"?t.duration_seconds:void 0}:{type:"text",text:String(t)}:{type:"text",text:String(t)})}async _serializeContentAsText(e){if(this._looksLikeMultimodalContent(e)){let t=this._normalizeContentParts(e),o=await this._processContentParts(t);return JSON.stringify(o)}return typeof e=="object"&&e!==null?JSON.stringify(e):String(e??"")}async _serializeContentAsParts(e){if(!this._looksLikeMultimodalContent(e))return null;let t=this._normalizeContentParts(e);return await this._processContentParts(t)}async _makeRequest(e,t,o,n){let i=new URL(t,this.baseUrl);n&&Object.entries(n).forEach(([a,r])=>{r!=null&&(Array.isArray(r)?r.forEach(u=>{i.searchParams.append(a,String(u))}):i.searchParams.append(a,String(r)))});let c=this._buildAuthHeaders(!0),l=new AbortController,m=setTimeout(()=>l.abort(),this.timeout);try{let a=await fetch(i.toString(),{method:e,headers:c,body:o?JSON.stringify(o):void 0,signal:l.signal});if(clearTimeout(m),a.status===200||a.status===202)return await a.json();if(a.status===401)throw new I("Invalid API key");if(a.status===429)throw new T("Rate limit exceeded");if(a.status===400){let r=await a.json().catch(()=>({}));throw new S(r.message||"Validation error",r.details)}else if(a.status===422){let r=await a.json().catch(()=>({}));throw console.error("[SDK] 422 Validation error - Full details:"),console.error("  Status:",a.status),console.error("  Error data:",JSON.stringify(r,null,2)),console.error("  Message:",r.message),console.error("  Detail:",r.detail),new S(r.message||(typeof r.detail=="string"?r.detail:JSON.stringify(r.detail))||"Validation error",r)}else{let r=await a.json().catch(()=>({}));throw new _(r.message||`API error: ${a.status}`,a.status,r)}}catch(a){throw clearTimeout(m),a instanceof _?a:a instanceof Error&&a.name==="AbortError"?new d(`Request timed out after ${this.timeout} milliseconds`):a instanceof Error?new d(`Request failed: ${a.message}`,a):new d(`Request failed: ${String(a)}`)}}async createCollection(e){let t={name:e.name};e.description&&(t.description=e.description),e.metadata&&(t.metadata=e.metadata);let o=await this._makeRequest("POST","/v1/collections",t),n=o.results||o;return this._collectionFromDict(n)}async getCollection(e){let t=await this._makeRequest("GET",`/v1/collections/${e}`),o=t.results||t;return this._collectionFromDict(o)}async getCollectionByName(e){let t=await this._makeRequest("GET",`/v1/collections/name/${e}`),o=t.results||t;return this._collectionFromDict(o)}async listCollections(e){let t={limit:e?.limit??100,offset:e?.offset??0};e?.name!==void 0&&(t.name=e.name);let o=await this._makeRequest("GET","/v1/collections",void 0,t),n;return typeof o=="object"&&o!==null&&"results"in o?n=o.results:Array.isArray(o)?n=o:n=[o],n.map(i=>this._collectionFromDict(i))}async updateCollection(e){let t={};e.name!==void 0&&(t.name=e.name),e.description!==void 0&&(t.description=e.description),e.metadata!==void 0&&(t.metadata=e.metadata);let o=await this._makeRequest("POST",`/v1/collections/${e.collectionId}`,t),n=o.results||o;return this._collectionFromDict(n)}async deleteCollection(e){return await this._makeRequest("DELETE",`/v1/collections/${e}`),!0}async store(e,t,o={}){let n={...o,memory_type:"memory",timestamp:new Date().toISOString()},i={collection_id:t,raw_text:String(e||""),metadata:n,ingestion_mode:"fast"},c=await this._makeRequest("POST","/v1/memories",i),l=c?.results?.engram_id||c?.results?.id||c?.id||"",m=n.timestamp;return{id:String(l),memory_id:String(l),content:String(e||""),metadata:n,collection_ids:[t],created_at:m,updated_at:m}}async storeMemory(e,t){let o;if("collection_id"in e)o=e;else{let u=e;o={collection_id:u.collection_id||u.collectionId||"",content:u.content||"",role:u.role,memory_id:u.memory_id||u.memoryId||void 0,metadata:u.metadata||{}}}if(o.memory_id)return await this._appendToMemory(o.memory_id,o);if((o.role?"conversation":"document")==="conversation"){let u=[];if(o.content&&o.role){let b=await this._serializeContentAsParts(o.content)??await this._serializeContentAsText(o.content),g=o;u.push({content:b,role:o.role,metadata:o.metadata||{},...typeof g.authority=="number"?{authority:Number(g.authority)}:{}})}if(u.length===0)throw new d("Cannot create conversation without messages. Provide content and role.");let p={collection_id:o.collection_id,name:t||"Conversation",messages:u,metadata:o.metadata||{}},y=await this._makeRequest("POST","/v1/memories",p);if(y.results){let h=y.results.memory_id||y.results.id;if(!h)throw new d("Failed to create conversation: no id returned");return String(h)}throw new d("Failed to create conversation: invalid response format")}let i={...o.metadata};i.memory_type="memory";let c=o;if(typeof c.authority=="number"){let u=Number(c.authority);!Number.isNaN(u)&&u>=0&&u<=1&&(i.authority=u)}let l,m=await this._serializeContentAsParts(o.content);if(m)l={collection_id:o.collection_id,content_parts:m,metadata:i,ingestion_mode:"fast"};else if(Array.isArray(o.content)&&o.content.every(u=>typeof u=="string"))l={collection_id:o.collection_id,chunks:o.content,metadata:i,ingestion_mode:"fast"};else{let u=await this._serializeContentAsText(o.content);if(!u||u==='""'||u==="[]"||u==="{}")throw new d("Content is required for document memories");l={collection_id:o.collection_id,raw_text:u,metadata:i,ingestion_mode:"fast"}}let a=await this._makeRequest("POST","/v1/memories",l),r=a?.results?.engram_id||a?.results?.id||a?.id||"";return String(r||"")}async _appendToMemory(e,t){let o=t.collection_id,n=t.content,i=t.metadata;if(!o)throw new d("collection_id is required");let c={collection_id:o};if(Array.isArray(n))n.length>0&&typeof n[0]=="object"&&"content"in n[0]?c.messages=n:c.chunks=n;else if(typeof n=="string")c.raw_text=n;else throw new d("content must be a string, array of strings, or array of message objects");i&&(c.metadata=i);try{return await this._makeRequest("POST",`/v1/memories/${e}/append`,c),e}catch(l){throw l instanceof _&&l.statusCode===404?new w(e,"Memory"):l}}async storeMemories(e){let t=[],o={},n=[];for(let i of e)if(i.role){let c=i.memory_id||`__new__::${i.collection_id}`;o[c]||(o[c]=[]),o[c].push(i)}else n.push(i);for(let[i,c]of Object.entries(o)){let l=c[0].collection_id,m,a=[];for(let r of c){let p=await this._serializeContentAsParts(r.content)??await this._serializeContentAsText(r.content);if(typeof p=="string"){if(!p.trim())continue}else if(p.length===0)continue;let y=r;a.push({content:p,role:r.role,metadata:r.metadata||{},...typeof y.authority=="number"?{authority:Number(y.authority)}:{}})}if(!a.length)throw new d("Cannot create/append conversation without messages. Provide non-empty content.");if(i.startsWith("__new__::")){let r={collection_id:l,name:"Conversation",messages:a,metadata:{}},u=await this._makeRequest("POST","/v1/memories",r);if(u.results){if(m=u.results.memory_id||u.results.id||"",!m)throw new d("Failed to create conversation: no id returned")}else throw new d("Failed to create conversation: invalid response format")}else{m=i;let r={collection_id:l,content:a,memory_id:m,metadata:{}};await this._appendToMemory(m,r)}t.push(...Array(c.length).fill(String(m)))}for(let i of n)t.push(await this.storeMemory(i));return t}async delete(e){try{if(console.log("[SDK] delete() called with:",{memoryIds:e,type:typeof e,isArray:Array.isArray(e)}),typeof e=="string"){console.log("[SDK] Single deletion path for ID:",e);try{return await this._makeRequest("DELETE",`/v1/memories/${e}`),!0}catch{console.log("[SDK] Falling back to POST /v1/memories/delete with single ID");let t=await this._makeRequest("POST","/v1/memories/delete",e);return typeof t=="object"&&t.success!==void 0?t.success:!0}}else{console.log("[SDK] Batch deletion path for IDs:",e),console.log("[SDK] Sending POST request with body:",e);let t=await this._makeRequest("POST","/v1/memories/delete",e);return console.log("[SDK] Batch deletion response:",t),t}}catch(t){throw console.error("[SDK] Delete error:",t),t instanceof Error?t:new d(`Unknown error: ${String(t)}`)}}async deleteChunk(e){try{return await this._makeRequest("DELETE",`/v1/chunks/${e}`),!0}catch(t){throw t instanceof _&&t.statusCode===404?new w(e,"Chunk"):t}}async updateChunk(e,t,o){let n={content:t};o!==void 0&&(n.metadata=o);try{return await this._makeRequest("PATCH",`/v1/chunks/${e}`,n),!0}catch(i){throw i instanceof _&&i.statusCode===404?new w(e,"Chunk"):i}}async updateMemory(e){let t={};if(e.name!==void 0&&(t.name=e.name),e.metadata!==void 0&&(t.metadata=e.metadata,t.merge_metadata=e.mergeMetadata??!1),e.collectionIds!==void 0&&(t.collection_ids=e.collectionIds),Object.keys(t).length===0)throw new S("At least one field (name, metadata, or collectionIds) must be provided to update");try{return await this._makeRequest("PATCH",`/v1/memories/${e.memoryId}`,t),!0}catch(o){throw o instanceof _&&o.statusCode===404?new w(e.memoryId,"Memory"):o}}async listMemories(e){let t=Array.isArray(e.collection_ids)?e.collection_ids:[e.collection_ids];if(!t.length)throw new d("collection_ids must be provided to list_memories().");let o={limit:e.limit??100,offset:e.offset??0,collection_ids:t};e.metadata_filters&&(o.metadata_filters=JSON.stringify(e.metadata_filters));let n=await this._makeRequest("GET","/v1/memories",void 0,o),i;return typeof n=="object"&&n!==null&&"results"in n?i=n.results:Array.isArray(n)?i=n:i=[n],i.map(c=>this._memoryResponseFromDict(c,t))}async getMemory(e){let t=await this._makeRequest("GET",`/v1/memories/${e}`),o=t.text||t.content,n=Array.isArray(t.chunks)?t.chunks:void 0,i={id:t.id,content:o,chunks:n,metadata:t.metadata||{},collection_ids:t.collection_ids||[]};return this._memoryResponseFromDict(i,[])}async search(e){let t={query:e.query};if(e.effort&&(t.effort=e.effort),e.collection_ids){let l=(Array.isArray(e.collection_ids)?e.collection_ids:[e.collection_ids]).filter(m=>m&&m.trim()!=="");l.length&&(t.collection_ids=l)}e.filters&&(t.filters=e.filters),e.searchSettings&&(t.search_settings=e.searchSettings);let n=(await this._makeRequest("POST","/v1/memories/search",t)).results;return{query:n.query||e.query,entities:n.entities||[],facts:n.facts||[],utterances:n.utterances||[],inference_hints:n.inference_hints||[],fact_to_chunks:n.fact_to_chunks||{},entity_to_facts:n.entity_to_facts||{},retrieved_at:n.retrieved_at||new Date().toISOString(),focus:n.focus,total_traversal_time_ms:n.total_traversal_time_ms,query_intent:n.query_intent}}async healthCheck(){return this._makeRequest("GET","/v1/health")}_collectionFromDict(e){let t;e.created_at&&(typeof e.created_at=="string"?t=e.created_at:e.created_at instanceof Date&&(t=e.created_at.toISOString()));let o;e.updated_at&&(typeof e.updated_at=="string"?o=e.updated_at:e.updated_at instanceof Date&&(o=e.updated_at.toISOString()));let n=String(e.id||""),i=String(e.name||""),c=typeof e.description=="string"?e.description:void 0,l=e.owner_id?String(e.owner_id):void 0,m=typeof e.memory_count=="number"?e.memory_count:0,a={graph_collection_status:String(e.graph_collection_status||""),graph_sync_status:String(e.graph_sync_status||""),user_count:typeof e.user_count=="number"?e.user_count:0};return{id:n,name:i,description:c,metadata:a,created_at:t,updated_at:o,memory_count:m,owner_id:l}}_memoryResponseFromDict(e,t){let o;e.created_at&&(typeof e.created_at=="string"?o=e.created_at:e.created_at instanceof Date&&(o=e.created_at.toISOString()));let n;e.updated_at&&(typeof e.updated_at=="string"?n=e.updated_at:e.updated_at instanceof Date&&(n=e.updated_at.toISOString()));let i=String(e.id||""),c=typeof e.content=="string"?e.content:typeof e.text=="string"?e.text:void 0,l;e.chunks&&Array.isArray(e.chunks)&&(e.chunks.every(r=>typeof r=="string")?l=e.chunks.map(r=>({id:"",content:r,metadata:{}})):l=e.chunks.filter(r=>r&&typeof r=="object"&&("text"in r||"content"in r)).map(r=>({id:String(r.id||""),content:String(r.text||r.content||""),metadata:typeof r.metadata=="object"&&r.metadata!==null?r.metadata:{},role:typeof r.role=="string"?r.role:void 0})));let m={...typeof e.metadata=="object"&&e.metadata!==null?e.metadata:{}};e.engram_id&&(m.engram_id=e.engram_id);let a=i;return e.engram_id&&!i&&(a=String(e.engram_id)),e.document_metadata&&typeof e.document_metadata=="object"&&Object.assign(m,e.document_metadata),{id:a,memory_id:a,content:c,chunks:l,metadata:m,collection_ids:Array.isArray(e.collection_ids)?e.collection_ids:t,created_at:o,updated_at:n}}_searchResultFromDict(e){let t=typeof e.content=="string"?e.content:typeof e.text=="string"?e.text:"",o=String(e.id||e.chunk_id||"");return{id:String(o),content:String(t),score:typeof e.score=="number"?e.score:Number(e.score||0),metadata:typeof e.metadata=="object"&&e.metadata!==null?e.metadata:{},source:typeof e.source=="string"?e.source:void 0}}_searchResultFromGraphDict(e){let t=e.id?String(e.id):"",o=typeof e.result_type=="string"?e.result_type:"entity",n=N[o.toUpperCase()]||"entity",i=typeof e.content=="object"&&e.content!==null?e.content:{},c=e.score!==void 0?Number(e.score):0,l=typeof e.metadata=="object"&&e.metadata!==null?e.metadata:{},m=Array.isArray(e.chunk_ids)?e.chunk_ids:void 0,a;if(e.timestamp)if(typeof e.timestamp=="string")a=e.timestamp;else if(e.timestamp instanceof Date)a=e.timestamp.toISOString();else{let E=new Date(String(e.timestamp));Number.isNaN(E.valueOf())||(a=E.toISOString())}let r=typeof e.display_name=="string"?e.display_name:void 0,u=typeof e.source_role=="string"?e.source_role:void 0,p=e.engram_id?String(e.engram_id):void 0,y=e.owner_id?String(e.owner_id):void 0,h,b,g;return n==="entity"?h={id:i.id?String(i.id):void 0,name:String(i.name||""),description:String(i.description||""),metadata:typeof i.metadata=="object"&&i.metadata!==null?i.metadata:{}}:n==="relationship"?b={id:i.id?String(i.id):void 0,subject:String(i.subject||""),predicate:String(i.predicate||""),object:String(i.object||""),subject_id:i.subject_id?String(i.subject_id):void 0,object_id:i.object_id?String(i.object_id):void 0,description:typeof i.description=="string"?i.description:void 0,metadata:typeof i.metadata=="object"&&i.metadata!==null?i.metadata:{}}:g={id:i.id?String(i.id):void 0,name:String(i.name||""),summary:String(i.summary||""),metadata:typeof i.metadata=="object"&&i.metadata!==null?i.metadata:{}},{id:t,score:c,metadata:l,source:"graph",content:void 0,graph_result_type:n,graph_entity:h,graph_relationship:b,graph_community:g,chunk_ids:m,timestamp:a,display_name:r,source_role:u,engram_id:p,owner_id:y}}async _sha256(e){let t=new TextEncoder().encode(e),o;typeof globalThis.crypto<"u"&&globalThis.crypto.subtle?o=globalThis.crypto:o=(await import("crypto")).webcrypto;let n=await o.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map(l=>l.toString(16).padStart(2,"0")).join("")}_formDataFromObject(e){let t=new FormData;return Object.entries(e).forEach(([o,n])=>{t.append(o,n)}),t}async _processContentParts(e){let t=[];for(let o of e){if(o.type!=="text"&&o.type!=="s3_ref"&&"data"in o&&o.data){let n=o,i=Math.floor(String(n.data).length*3/4);if(i>j.MAX_INLINE_SIZE){let c=n.filename||"file.bin",l=n.media_type||"application/octet-stream",m=await this.getUploadUrl({filename:c,content_type:l,file_size:i}),a,r=globalThis.atob;if(typeof r=="function"){let u=r(String(n.data));a=new Uint8Array(u.length);for(let p=0;p<u.length;p++)a[p]=u.charCodeAt(p)}else{let{Buffer:u}=await import("buffer");a=Uint8Array.from(u.from(String(n.data),"base64"))}await fetch(m.upload_url,{method:"PUT",body:a,headers:{"Content-Type":l}}),t.push({type:"s3_ref",s3_key:m.s3_key,media_type:l,filename:c});continue}}t.push(o)}return t}async getUploadUrl(e){let t=await this._makeRequest("POST","/v1/memories/upload",void 0,{filename:e.filename,content_type:e.content_type,file_size:e.file_size});return t.results?t.results:t}};P.MAX_INLINE_SIZE=5*1024*1024;var R=P,J={".jpg":"image/jpeg",".jpeg":"image/jpeg",".png":"image/png",".gif":"image/gif",".webp":"image/webp",".heic":"image/heic",".bmp":"image/bmp",".tiff":"image/tiff",".mp3":"audio/mpeg",".wav":"audio/wav",".m4a":"audio/m4a",".ogg":"audio/ogg",".flac":"audio/flac",".aac":"audio/aac",".webm":"audio/webm",".pdf":"application/pdf",".doc":"application/msword",".docx":"application/vnd.openxmlformats-officedocument.wordprocessingml.document",".xls":"application/vnd.ms-excel",".xlsx":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",".ppt":"application/vnd.ms-powerpoint",".pptx":"application/vnd.openxmlformats-officedocument.presentationml.presentation",".txt":"text/plain",".csv":"text/csv",".rtf":"application/rtf",".epub":"application/epub+zip"},C=class{static async fromFile(s,e){let t,o;try{t=await import("fs/promises"),o=await import("path")}catch{throw new Error("File system operations are only supported in Node.js environments.")}let n=o.resolve(s),i=o.basename(n),c=o.extname(n).toLowerCase(),l=e||J[c]||"application/octet-stream";return{data:(await t.readFile(n)).toString("base64"),media_type:l,filename:i}}},V=s=>s,Y=Object.assign(V,{File:C.fromFile,async fromFile(s,e,t,o){return{collection_id:e,content:[await C.fromFile(s)],metadata:t||{},role:o}}});f.GraphSearchResultType=N;f.Memory=Y;f.Nebula=R;f.NebulaAuthenticationException=I;f.NebulaClientException=d;f.NebulaCollectionNotFoundException=H;f.NebulaContent=C;f.NebulaException=_;f.NebulaNotFoundException=w;f.NebulaRateLimitException=T;f.NebulaValidationException=S;f.default=R});var F=A((he,q)=>{var D=require("node:fs"),W=require("node:path"),X=require("node:os"),x=W.join(X.homedir(),".nebula-claude","settings.json");function Z(){let s={debug:!1};try{if(D.existsSync(x)){let e=D.readFileSync(x,"utf-8");Object.assign(s,JSON.parse(e))}}catch(e){console.error(`Settings: Failed to load ${x}: ${e.message}`)}return process.env.CC_NEBULA_API_KEY&&(s.apiKey=process.env.CC_NEBULA_API_KEY),process.env.CC_NEBULA_COLLECTION_ID&&(s.collectionId=process.env.CC_NEBULA_COLLECTION_ID),process.env.CC_NEBULA_DEBUG==="true"&&(s.debug=!0),s}function Q(s){if(s.apiKey)return s.apiKey;throw new Error("apiKey is required in ~/.nebula-claude/settings.json or CC_NEBULA_API_KEY env var")}function ee(s,e,t){if(s.debug){let o=new Date().toISOString();console.error(t?`[${o}] ${e}: ${JSON.stringify(t)}`:`[${o}] ${e}`)}}q.exports={loadSettings:Z,getApiKey:Q,debugLog:ee}});var K=A((ge,$)=>{var{Nebula:te}=O(),{loadSettings:oe,getApiKey:ne}=F();async function ie(){let s=oe(),e=ne(s),t=s.collectionId;if(!t)throw new Error("collectionId is required in ~/.nebula-claude/settings.json or CC_NEBULA_COLLECTION_ID env var");return{client:new te({apiKey:e}),collectionId:t,settings:s}}$.exports={getProjectClient:ie}});var{getProjectClient:se}=K();async function re(){let s=process.argv.slice(2).join(" ");if(!s?.trim()){console.log('Usage: search-memory.cjs "query"');return}let{client:e,collectionId:t}=await se(),n=(await e.search({query:s,collection_ids:[t]})).utterances||[];if(n.length===0){console.log("No memories found.");return}for(let[i,c]of n.entries()){let l=Math.round((c.activation_score||0)*100),m=c.source_role?`[${c.source_role}] `:"";console.log(`**${i+1}.** (${l}% match)`),console.log(`${m}${c.text||""}
`)}}re().catch(s=>{console.error(`Error: ${s.message}`),process.exit(1)});
